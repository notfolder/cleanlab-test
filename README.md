# 概要

openlabを使ってconfident learningを評価するプログラム.

出来ること:

- 10x10のノイズマトリックスからmnistのノイズ付きラベルを生成する
- ノイズ付きラベルを使ってconfident learningでの学習を実施し,推論結果を評価する
- ノイズ付きラベルを使ってノイズマトリックスと誤っているインデックスの推論をする

# Usage

```
usage: cleanlab-test.py [-h] [--seed SEED] [--noise_prob NOISE_PROB] [--output OUTPUT] [--device DEVICE] [--cv_n_folds CV_N_FOLDS]
                        [--batch_size BATCH_SIZE] [--epoch EPOCH]

cleanlab-test program.

optional arguments:
  -h, --help            show this help message and exit
  --seed SEED           random seed.
  --noise_prob NOISE_PROB
                        noise probability.
  --output OUTPUT       output csv filename.
  --device DEVICE       pytorch device.
  --cv_n_folds CV_N_FOLDS
                        The number of cross-validation folds used to compute
  --batch_size BATCH_SIZE
                        batch size.
  --epoch EPOCH         epoch.
```

# 出力例

```
$ python cleanlab-test.py 
seed: 0
noise_prob: 0.1
output: ./noise_estimate.csv
device: cuda:0
cv_n_folds: 10
batch_size: 2048
epoch: 10
==== ノイズマトリックス ====
[[0.2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 0.1, 0.0],
 [0.0, 0.2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.1, 0.0],
 [0.0, 0.0, 0.2, 0.1, 0.0, 0.1, 0.0, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.1, 0.2, 0.0, 0.1, 0.0, 0.0, 0.0, 0.0],
 [0.0, 0.1, 0.0, 0.0, 0.2, 0.0, 0.0, 0.0, 0.0, 0.1],
 [0.0, 0.1, 0.1, 0.0, 0.0, 0.2, 0.0, 0.0, 0.0, 0.0],
 [0.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.0, 0.1, 0.0],
 [0.0, 0.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.0, 0.1],
 [0.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 0.2, 0.0],
 [0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 0.0, 0.1, 0.0, 0.2]]
==== Noisy Labelの評価 ====
正解ラベル-ノイズラベルのconfusion_matrix:
[[4739    0    0    0    0    0  592    0  592    0]
 [   0 4720    0    0  674  674    0  674    0    0]
 [   0    0 4768  595    0  595    0    0    0    0]
 [   0    0  613 5518    0    0    0    0    0    0]
 [   0    0    0    0 5258    0    0    0    0  584]
 [   0    0  542  542    0 4337    0    0    0    0]
 [ 591    0    0    0    0    0 4736    0  591    0]
 [   0  626    0    0    0    0    0 5013    0  626]
 [ 585  585    0    0    0    0  585    0 4096    0]
 [   0    0    0    0  594    0    0  594    0 4761]]
正解ラベル-ノイズラベルのclassification_report:
              precision    recall  f1-score   support

           0       0.80      0.80      0.80      5923
           1       0.80      0.70      0.74      6742
           2       0.80      0.80      0.80      5958
           3       0.83      0.90      0.86      6131
           4       0.81      0.90      0.85      5842
           5       0.77      0.80      0.79      5421
           6       0.80      0.80      0.80      5918
           7       0.80      0.80      0.80      6265
           8       0.78      0.70      0.74      5851
           9       0.80      0.80      0.80      5949

    accuracy                           0.80     60000
   macro avg       0.80      0.80      0.80     60000
weighted avg       0.80      0.80      0.80     60000

==== Noisy Labelでの通常の学習による推定 ====
              precision    recall  f1-score   support

           0       0.96      0.99      0.97       980
           1       0.98      0.98      0.98      1135
           2       0.99      0.93      0.96      1032
           3       0.92      0.98      0.95      1010
           4       0.95      0.98      0.96       982
           5       0.97      0.96      0.96       892
           6       0.99      0.94      0.96       958
           7       0.97      0.96      0.97      1028
           8       0.96      0.94      0.95       974
           9       0.94      0.95      0.95      1009

    accuracy                           0.96     10000
   macro avg       0.96      0.96      0.96     10000
weighted avg       0.96      0.96      0.96     10000

==== Noisy LabelのConsistent Learningによる学習結果の評価 ====
[[ 972    0    4    0    0    0    0    0    3    1]
 [   0 1122    4    0    1    2    2    1    3    0]
 [   7    1  990   11    1    1    2    7   12    0]
 [   1    0    8  986    0    4    0    5    3    3]
 [   2    1    5    0  942    0    2    6    2   22]
 [   3    0    0   14    0  858    5    3    6    3]
 [  21    3    1    1    5    1  925    0    1    0]
 [   2    5    8    2    1    0    0 1007    1    2]
 [   8    2    7    6    2    8    1    5  931    4]
 [   4    1    0    6   11    3    0   33    2  949]]
              precision    recall  f1-score   support

           0       0.95      0.99      0.97       980
           1       0.99      0.99      0.99      1135
           2       0.96      0.96      0.96      1032
           3       0.96      0.98      0.97      1010
           4       0.98      0.96      0.97       982
           5       0.98      0.96      0.97       892
           6       0.99      0.97      0.98       958
           7       0.94      0.98      0.96      1028
           8       0.97      0.96      0.96       974
           9       0.96      0.94      0.95      1009

    accuracy                           0.97     10000
   macro avg       0.97      0.97      0.97     10000
weighted avg       0.97      0.97      0.97     10000

==== Consistent Learningによるエラーマトリックス推定時に得られた結果の評価 ====
[[5833    1    9    3    1   12   37    2   18    7]
 [   2 6643   13    7    9   23    1   29   14    1]
 [  19   10 5653   91    9  122   10   21   17    6]
 [   6    7   80 5921    1   51    0   20   29   16]
 [   5   13    7    0 5622   10   12   24    4  145]
 [   7    6   18  109    3 5193   30    4   28   23]
 [  77    8    4    1   11   25 5757    1   33    1]
 [   4   39   32   10   13    5    0 6075    7   80]
 [  58   98   22   47   16   42   47   10 5488   23]
 [  11    5    6   19  141   24    3  117   16 5607]]
              precision    recall  f1-score   support

           0       0.97      0.98      0.98      5923
           1       0.97      0.99      0.98      6742
           2       0.97      0.95      0.96      5958
           3       0.95      0.97      0.96      6131
           4       0.96      0.96      0.96      5842
           5       0.94      0.96      0.95      5421
           6       0.98      0.97      0.97      5918
           7       0.96      0.97      0.97      6265
           8       0.97      0.94      0.95      5851
           9       0.95      0.94      0.95      5949

    accuracy                           0.96     60000
   macro avg       0.96      0.96      0.96     60000
weighted avg       0.96      0.96      0.96     60000

[[4810    0    0    0    0    0  570    0  535    0]
 [   0 4828    0    0    0    0    0  596  504    3]
 [   2    0 4605  684    0  629    0    0    3    0]
 [   0    0  560 5522    0  563    0    2    5    3]
 [   0  630    0    0 5240    3    1   13    0  639]
 [   0  704  534   11    0 4350    5    1    1    0]
 [ 634    3    0    0    0    0 4646    0  630    0]
 [   2  789    2    0    9    0    0 4882    0  597]
 [ 673   11    3    0    0    0  606    0 3986    0]
 [   0   11    0    0  660    0    0  677    3 4620]]
[[0.79 0.   0.   0.   0.   0.   0.1  0.   0.09 0.  ]
 [0.   0.69 0.   0.   0.   0.   0.   0.1  0.09 0.  ]
 [0.   0.   0.81 0.11 0.   0.11 0.   0.   0.   0.  ]
 [0.   0.   0.1  0.89 0.   0.1  0.   0.   0.   0.  ]
 [0.   0.09 0.   0.   0.89 0.   0.   0.   0.   0.11]
 [0.   0.1  0.09 0.   0.   0.78 0.   0.   0.   0.  ]
 [0.1  0.   0.   0.   0.   0.   0.8  0.   0.11 0.  ]
 [0.   0.11 0.   0.   0.   0.   0.   0.79 0.   0.1 ]
 [0.11 0.   0.   0.   0.   0.   0.1  0.   0.7  0.  ]
 [0.   0.   0.   0.   0.11 0.   0.   0.11 0.   0.79]]
==== Consistent Learningによるエラーインデックスの評価 ====
[False False False ... False False False]
              precision    recall  f1-score   support

       False       0.98      0.99      0.98     47946
        True       0.94      0.93      0.94     12054

    accuracy                           0.98     60000
   macro avg       0.96      0.96      0.96     60000
weighted avg       0.97      0.98      0.97     60000
```
